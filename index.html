<!DOCTYPE html>
<html>
<head>
	<title>Project 1</title>

	<!-- Firebase -->
	<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>

	<!-- D3 Scripts and Map -->
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>

	<!-- CSS -->
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>


<div id="p4output"></div>

<div id="map"></div>
<script>

var width = 960, height = 500;
// A projection is a particular type of scale, that maps
// a pair of LONGITUDE, LATITUDE coordinates (NOT the other
// way around) to a point in pixel space.
var projection = d3.geo.equirectangular();
// Look at the documentation https://github.com/mbostock/d3/wiki/Geo-Projections
// for different projections and ways to change the 
// zoom and center of the projection. 

// This function will convert a set of coordinates
//  into a <path> attribute.
var path = d3.geo.path().projection(projection);
	
var svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);
var g = svg.append("g");

// We need to declare a variable outside the scope of
//  the json callback if we want to examine it. This 
//  is useful for debugging.
var worldObjects;

// Get a JSON file containing coordinates of 
//  countries and landmasses. This is from an 
//  example provided by Mike Bostock.
d3.json("world-50m.json", function(error, world) {
	worldObjects = world;
	
	// ANY time we do I/O we should check for errors.
	if (error) { console.log(error); }
	
	// Get an array of coordinate lists for 241 
	//  geographic entites. This includes sovereign 
	//  countries as well as territories like Guam.
	var countries = topojson.feature(world, world.objects.countries).features;
	
	// convert each country's data into a path element.
	countries.forEach(function (country) {
		g.append("path").attr("d", path(country))
		.style("fill", "#ccc")
		.style("stroke", "#888");
	});
	
	// We can use the projection function to get
	//  the location of a point. This is useful for
	//  data that comes with specific long/lats.

	// Testing Asia 6 Earthquakes.

	var earthquakeRef = new Firebase("https://publicdata-earthquakes.firebaseio.com/by_continent/");

earthquakeRef.child("north_america/6").on("child_added", showEarthquake);
earthquakeRef.child("south_america/6").on("child_added", showEarthquake);
earthquakeRef.child("africa/6").on("child_added", showEarthquake);
earthquakeRef.child("asia/6").on("child_added", showEarthquake);
earthquakeRef.child("australia/6").on("child_added", showEarthquake);
earthquakeRef.child("europe/6").on("child_added", showEarthquake);
earthquakeRef.child("antarctica/6").on("child_added", showEarthquake);
earthquakeRef.child("oceanic/6").on("child_added", showEarthquake);

earthquakeRef.child("north_america/7").on("child_added", showEarthquake);
earthquakeRef.child("south_america/7").on("child_added", showEarthquake);
earthquakeRef.child("africa/7").on("child_added", showEarthquake);
earthquakeRef.child("asia/7").on("child_added", showEarthquake);
earthquakeRef.child("australia/7").on("child_added", showEarthquake);
earthquakeRef.child("europe/7").on("child_added", showEarthquake);
earthquakeRef.child("antarctica/7").on("child_added", showEarthquake);
earthquakeRef.child("oceanic/7").on("child_added", showEarthquake);

earthquakeRef.child("north_america/8").on("child_added", showEarthquake);
earthquakeRef.child("south_america/8").on("child_added", showEarthquake);
earthquakeRef.child("africa/8").on("child_added", showEarthquake);
earthquakeRef.child("asia/8").on("child_added", showEarthquake);
earthquakeRef.child("australia/8").on("child_added", showEarthquake);
earthquakeRef.child("europe/8").on("child_added", showEarthquake);
earthquakeRef.child("antarctica/8").on("child_added", showEarthquake);
earthquakeRef.child("oceanic/8").on("child_added", showEarthquake);

earthquakeRef.child("north_america/9").on("child_added", showEarthquake);
earthquakeRef.child("south_america/9").on("child_added", showEarthquake);
earthquakeRef.child("africa/9").on("child_added", showEarthquake);
earthquakeRef.child("asia/9").on("child_added", showEarthquake);
earthquakeRef.child("australia/9").on("child_added", showEarthquake);
earthquakeRef.child("europe/9").on("child_added", showEarthquake);
earthquakeRef.child("antarctica/9").on("child_added", showEarthquake);
earthquakeRef.child("oceanic/9").on("child_added", showEarthquake);

earthquakeRef.child("north_america/10").on("child_added", showEarthquake);
earthquakeRef.child("south_america/10").on("child_added", showEarthquake);
earthquakeRef.child("africa/10").on("child_added", showEarthquake);
earthquakeRef.child("asia/10").on("child_added", showEarthquake);
earthquakeRef.child("australia/10").on("child_added", showEarthquake);
earthquakeRef.child("europe/10").on("child_added", showEarthquake);
earthquakeRef.child("antarctica/10").on("child_added", showEarthquake);
earthquakeRef.child("oceanic/10").on("child_added", showEarthquake);




function showEarthquake(snapshot) {
    var earthquake = snapshot.val();
    console.log("Mag " + earthquake.mag + " at " + earthquake.place + " Date: " + earthquake.time);

    if(earthquake.mag >= 6){
    var coords = projection([earthquake.location.lng,earthquake.location.lat])
    g.append("circle").attr("cx", coords[0])
	.attr("cy", coords[1])
	.attr("r", 3).attr("fill","#84B6E1")
	.style("opacity",1)
	.attr("stroke","black");
    }

    if(earthquake.mag >= 7){
    var coords = projection([earthquake.location.lng,earthquake.location.lat])
    g.append("circle").attr("cx", coords[0])
	.attr("cy", coords[1])
	.attr("r", 10).attr("fill", "#9C6D92")
	.style("opacity",0.5)
    }

    if(earthquake.mag >= 8){
    var coords = projection([earthquake.location.lng,earthquake.location.lat])
    g.append("circle").attr("cx", coords[0])
	.attr("cy", coords[1])
	.attr("r", 16).attr("fill", "red")
	.style("opacity",0.5);
    }

}

// colors
// #2F4759,#276B74,#2D9080,#59B47D,#9CD471,#EFEE69


	// Sample Text labels
	// var ithacaLabel = projection([-77,44]);
	// g.append("text").text("Ithaca, NY, USA").attr("x",ithacaLabel[0]).attr("y",ithacaLabel[1]).style("fill","226666");

	// var sgLabel = projection([103,3]);
	// g.append("text").text("Singapore, Singapore").attr("x",sgLabel[0]).attr("y",sgLabel[1]).style("fill","226666");;

	// var jpLabel = projection([136,37]);
	// g.append("text").text("Gifu, Japan").attr("x",jpLabel[0]).attr("y",jpLabel[1]).style("fill","226666");




});


</script>



</body>
</html>